# S1.14: Kitchen Display Real-Time UI

**Sprint**: 1  
**Story Points**: 8  
**Assignee**: Developer B  
**Priority**: P0 - Critical  
**Dependencies**: S1.13 (WebSocket Infrastructure)

---

## User Story

As a **kitchen staff member**, I want to **see new orders appear in real-time on a display** so that **I can prepare orders immediately without delays**.

---

## Description

Build the kitchen display UI that shows active orders in real-time using WebSocket connection. Orders appear automatically when cashiers complete sales, color-coded by age, and can be marked as preparing/ready/completed.

The display updates instantly without page refresh and maintains connection even with network hiccups.

---

## Acceptance Criteria

### Display Functionality
- [ ] Shows all active orders for the current location
- [ ] Orders display: order number, items with quantities, time elapsed
- [ ] Orders sorted by created_at (oldest first)
- [ ] Auto-refreshes when new order arrives via WebSocket
- [ ] Color coding by age:
  - Green: < 10 minutes
  - Yellow: 10-20 minutes  
  - Red: > 20 minutes

### Interaction
- [ ] Can click "Preparing" button to update order status
- [ ] Can click "Ready" button when order is complete
- [ ] Can click "Complete" to remove from display
- [ ] Status changes reflected in database
- [ ] Status changes broadcast to POS terminals

### Connection Handling
- [ ] Auto-connects to WebSocket on page load
- [ ] Shows "Connected" indicator (green dot)
- [ ] Shows "Disconnected" indicator (red dot) when offline
- [ ] Auto-reconnects with exponential backoff
- [ ] Displays reconnection attempts

---

## Definition of Done

- [x] Kitchen display page implemented in React
- [x] WebSocket connection established on mount
- [x] Real-time order updates working
- [x] Color coding based on order age
- [x] Status update buttons functional
- [x] Responsive design (works on tablet)
- [x] Manual testing: Create order â†’ Appears instantly
- [x] Manual testing: Network disconnect â†’ Reconnects automatically
- [x] Code reviewed and approved
- [x] Deployed to dev environment

---

## Technical Details

### Component Structure
```tsx
KitchenDisplay.tsx
â”œâ”€â”€ WebSocketProvider
â”œâ”€â”€ ConnectionStatus
â””â”€â”€ OrderList
    â””â”€â”€ OrderCard (for each order)
        â”œâ”€â”€ OrderHeader (number, time)
        â”œâ”€â”€ ItemList
        â””â”€â”€ ActionButtons
```

### WebSocket Message Format
```typescript
interface KitchenOrderMessage {
  type: 'new_order' | 'order_updated' | 'order_completed';
  data: {
    id: string;
    orderNumber: string;
    items: Array<{
      name: string;
      quantity: number;
      modifiers?: string[];
    }>;
    status: 'pending' | 'preparing' | 'ready' | 'completed';
    createdAt: string;
  };
}
```

### Color Coding Logic
```typescript
const getOrderColor = (createdAt: string) => {
  const elapsed = Date.now() - new Date(createdAt).getTime();
  const minutes = elapsed / 1000 / 60;
  
  if (minutes < 10) return 'green';
  if (minutes < 20) return 'yellow';
  return 'red';
};
```

---

## Implementation Steps

1. Create `KitchenDisplay.tsx` page component
2. Set up WebSocket connection using custom hook
3. Subscribe to kitchen orders channel
4. Implement order list rendering
5. Add color coding based on elapsed time
6. Implement status update buttons
7. Add connection status indicator
8. Implement auto-reconnect logic
9. Add responsive styles for tablet view
10. Test with multiple simultaneous orders

---

## Testing

### Manual Test Cases

**Test 1: Real-time order receipt**
```
Given: Kitchen display is open
When: Cashier creates new sale
Then: Order appears instantly without refresh
```

**Test 2: Color coding**
```
Given: Order created 15 minutes ago
When: Page loads
Then: Order shown in yellow
```

**Test 3: Status updates**
```
Given: Order in "pending" status
When: Click "Preparing" button
Then: Order status updates to "preparing"
And: Database record updated
And: POS terminals notified
```

**Test 4: Reconnection**
```
Given: Kitchen display connected
When: Network disconnected
Then: Shows red "Disconnected" indicator
When: Network reconnected
Then: Auto-reconnects within 5 seconds
And: Shows green "Connected" indicator
And: All orders reload
```

---

## UI Mockup

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Kitchen Display        ðŸŸ¢ Connected             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Order #001234           â± 5 min      ðŸŸ¢  â”‚  â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚  â”‚
â”‚  â”‚ 2Ã— Kung Pao Chicken                       â”‚  â”‚
â”‚  â”‚    + Large, Extra Spicy                   â”‚  â”‚
â”‚  â”‚ 1Ã— Fried Rice                             â”‚  â”‚
â”‚  â”‚                                            â”‚  â”‚
â”‚  â”‚ [Preparing] [Ready] [Complete]            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Order #001235          â± 15 min     ðŸŸ¡   â”‚  â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚  â”‚
â”‚  â”‚ 1Ã— Orange Chicken                         â”‚  â”‚
â”‚  â”‚                                            â”‚  â”‚
â”‚  â”‚ [âœ“ Preparing] [Ready] [Complete]          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Time Estimate

**Estimated**: 4 hours (component) + 2 hours (WebSocket) + 2 hours (testing)  
**Actual**: ___ hours

---

## Notes

- Tablet-optimized (minimum 768px width)
- **Time Display**: Shows "time elapsed" since order created (not estimated completion)
  - Simple urgency indicator (red = old order, prioritize!)
  - Future enhancement (Backlog): Add prep_time field for intelligent completion estimates
- Consider using sound notification for new orders (future)
- Orders automatically removed after "Complete" clicked
- Persists orders in local state for fast rendering
- WebSocket URL from environment variable

---

## Related Stories

- **S1.13**: WebSocket Infrastructure Setup
- **S1.15**: POS Terminal - Order Confirmation
- **S3.13**: Real Receipt Printer Integration
